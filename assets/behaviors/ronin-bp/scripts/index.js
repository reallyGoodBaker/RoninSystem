import{CustomCommandParamType as t,CustomCommandStatus as e,CommandPermissionLevel as n,system as r,world as i,EntityEquippableComponent as s,EntityInventoryComponent as a,InputButton as o,ButtonState as c,HeldItemOption as u,EquipmentSlot as l,EntityHealthComponent as h}from"@minecraft/server";function p(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}function d(t,e){return function(n,r){e(n,r,t)}}function f(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var g;"function"==typeof SuppressedError&&SuppressedError,function(t){!function(){var e="object"==typeof globalThis?globalThis:"object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:function(){try{return Function("return this;")()}catch(t){}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch(t){}}(),n=r(t);function r(t,e){return function(n,r){Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0!==e.Reflect&&(n=r(e.Reflect,n)),function(t,e){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,o={__proto__:[]}instanceof Array,c=!a&&!o,u={create:a?function(){return ht(Object.create(null))}:o?function(){return ht({__proto__:null})}:function(){return ht({})},has:c?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:c?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),h="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:ct(),p="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:ut(),d="function"==typeof WeakMap?WeakMap:lt(),f=r?Symbol.for("@reflect-metadata:registry"):void 0,g=it(),y=st(g);function m(t,e,n,r){if(D(n)){if(!z(t))throw new TypeError;if(!H(e))throw new TypeError;return x(t,e)}if(!z(t))throw new TypeError;if(!B(e))throw new TypeError;if(!B(r)&&!D(r)&&!j(r))throw new TypeError;return j(r)&&(r=void 0),A(t,e,n=G(n),r)}function v(t,e){function n(n,r){if(!B(n))throw new TypeError;if(!D(r)&&!J(r))throw new TypeError;P(t,e,n,r)}return n}function w(t,e,n,r){if(!B(n))throw new TypeError;return D(r)||(r=G(r)),P(t,e,n,r)}function k(t,e,n){if(!B(e))throw new TypeError;return D(n)||(n=G(n)),O(t,e,n)}function b(t,e,n){if(!B(e))throw new TypeError;return D(n)||(n=G(n)),I(t,e,n)}function S(t,e,n){if(!B(e))throw new TypeError;return D(n)||(n=G(n)),R(t,e,n)}function _(t,e,n){if(!B(e))throw new TypeError;return D(n)||(n=G(n)),M(t,e,n)}function T(t,e){if(!B(t))throw new TypeError;return D(e)||(e=G(e)),N(t,e)}function C(t,e){if(!B(t))throw new TypeError;return D(e)||(e=G(e)),L(t,e)}function E(t,e,n){if(!B(e))throw new TypeError;if(D(n)||(n=G(n)),!B(e))throw new TypeError;D(n)||(n=G(n));var r=ot(e,n,!1);return!D(r)&&r.OrdinaryDeleteMetadata(t,e,n)}function x(t,e){for(var n=t.length-1;n>=0;--n){var r=(0,t[n])(e);if(!D(r)&&!j(r)){if(!H(r))throw new TypeError;e=r}}return e}function A(t,e,n,r){for(var i=t.length-1;i>=0;--i){var s=(0,t[i])(e,n,r);if(!D(s)&&!j(s)){if(!B(s))throw new TypeError;r=s}}return r}function O(t,e,n){if(I(t,e,n))return!0;var r=nt(e);return!j(r)&&O(t,r,n)}function I(t,e,n){var r=ot(e,n,!1);return!D(r)&&U(r.OrdinaryHasOwnMetadata(t,e,n))}function R(t,e,n){if(I(t,e,n))return M(t,e,n);var r=nt(e);return j(r)?void 0:R(t,r,n)}function M(t,e,n){var r=ot(e,n,!1);if(!D(r))return r.OrdinaryGetOwnMetadata(t,e,n)}function P(t,e,n,r){ot(n,r,!0).OrdinaryDefineOwnMetadata(t,e,n,r)}function N(t,e){var n=L(t,e),r=nt(t);if(null===r)return n;var i=N(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var s=new p,a=[],o=0,c=n;o<c.length;o++){var u=c[o];s.has(u)||(s.add(u),a.push(u))}for(var l=0,h=i;l<h.length;l++){u=h[l];s.has(u)||(s.add(u),a.push(u))}return a}function L(t,e){var n=ot(t,e,!1);return n?n.OrdinaryOwnMetadataKeys(t,e):[]}function F(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function D(t){return void 0===t}function j(t){return null===t}function $(t){return"symbol"==typeof t}function B(t){return"object"==typeof t?null!==t:"function"==typeof t}function q(t,e){switch(F(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n="string",r=Y(t,i);if(void 0!==r){var s=r.call(t,n);if(B(s))throw new TypeError;return s}return V(t)}function V(t,e){var n,r,i=t.toString;if(K(i)&&!B(r=i.call(t)))return r;if(K(n=t.valueOf)&&!B(r=n.call(t)))return r;throw new TypeError}function U(t){return!!t}function W(t){return""+t}function G(t){var e=q(t);return $(e)?e:W(e)}function z(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function K(t){return"function"==typeof t}function H(t){return"function"==typeof t}function J(t){switch(F(t)){case 3:case 4:return!0;default:return!1}}function X(t,e){return t===e||t!=t&&e!=e}function Y(t,e){var n=t[e];if(null!=n){if(!K(n))throw new TypeError;return n}}function Q(t){var e=Y(t,s);if(!K(e))throw new TypeError;var n=e.call(t);if(!B(n))throw new TypeError;return n}function Z(t){return t.value}function tt(t){var e=t.next();return!e.done&&e}function et(t){var e=t.return;e&&e.call(t)}function nt(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i||i===t?e:i}function rt(){var t,n,r,i;D(f)||void 0===e.Reflect||f in e.Reflect||"function"!=typeof e.Reflect.defineMetadata||(t=at(e.Reflect));var s=new d,a={registerProvider:o,getProvider:u,setProvider:g};return a;function o(e){if(!Object.isExtensible(a))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case t===e:break;case D(n):n=e;break;case n===e:break;case D(r):r=e;break;case r===e:break;default:void 0===i&&(i=new p),i.add(e)}}function c(e,s){if(!D(n)){if(n.isProviderFor(e,s))return n;if(!D(r)){if(r.isProviderFor(e,s))return n;if(!D(i))for(var a=Q(i);;){var o=tt(a);if(!o)return;var c=Z(o);if(c.isProviderFor(e,s))return et(a),c}}}if(!D(t)&&t.isProviderFor(e,s))return t}function u(t,e){var n,r=s.get(t);return D(r)||(n=r.get(e)),D(n)?(D(n=c(t,e))||(D(r)&&(r=new h,s.set(t,r)),r.set(e,n)),n):n}function l(t){if(D(t))throw new TypeError;return n===t||r===t||!D(i)&&i.has(t)}function g(t,e,n){if(!l(n))throw new Error("Metadata provider not registered.");var r=u(t,e);if(r!==n){if(!D(r))return!1;var i=s.get(t);D(i)&&(i=new h,s.set(t,i)),i.set(e,n)}return!0}}function it(){var t;return!D(f)&&B(e.Reflect)&&Object.isExtensible(e.Reflect)&&(t=e.Reflect[f]),D(t)&&(t=rt()),!D(f)&&B(e.Reflect)&&Object.isExtensible(e.Reflect)&&Object.defineProperty(e.Reflect,f,{enumerable:!1,configurable:!1,writable:!1,value:t}),t}function st(t){var e=new d,n={isProviderFor:function(t,n){var r=e.get(t);return!D(r)&&r.has(n)},OrdinaryDefineOwnMetadata:a,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:o,OrdinaryDeleteMetadata:c};return g.registerProvider(n),n;function r(r,i,s){var a=e.get(r),o=!1;if(D(a)){if(!s)return;a=new h,e.set(r,a),o=!0}var c=a.get(i);if(D(c)){if(!s)return;if(c=new h,a.set(i,c),!t.setProvider(r,i,n))throw a.delete(i),o&&e.delete(r),new Error("Wrong provider for target.")}return c}function i(t,e,n){var i=r(e,n,!1);return!D(i)&&U(i.has(t))}function s(t,e,n){var i=r(e,n,!1);if(!D(i))return i.get(t)}function a(t,e,n,i){r(n,i,!0).set(t,e)}function o(t,e){var n=[],i=r(t,e,!1);if(D(i))return n;for(var s=Q(i.keys()),a=0;;){var o=tt(s);if(!o)return n.length=a,n;var c=Z(o);try{n[a]=c}catch(t){try{et(s)}finally{throw t}}a++}}function c(t,n,i){var s=r(n,i,!1);if(D(s))return!1;if(!s.delete(t))return!1;if(0===s.size){var a=e.get(n);D(a)||(a.delete(i),0===a.size&&e.delete(a))}return!0}}function at(t){var e=t.defineMetadata,n=t.hasOwnMetadata,r=t.getOwnMetadata,i=t.getOwnMetadataKeys,s=t.deleteMetadata,a=new d;return{isProviderFor:function(t,e){var n=a.get(t);return!(D(n)||!n.has(e))||!!i(t,e).length&&(D(n)&&(n=new p,a.set(t,n)),n.add(e),!0)},OrdinaryDefineOwnMetadata:e,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:r,OrdinaryOwnMetadataKeys:i,OrdinaryDeleteMetadata:s}}function ot(t,e,n){var r=g.getProvider(t,e);if(!D(r))return r;if(n){if(g.setProvider(t,e,y))return y;throw new Error("Illegal state.")}}function ct(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[s]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,X(e,this._cacheKey)&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[s]=function(){return this.entries()},e.prototype._find=function(t,e){if(!X(this._cacheKey,t)){this._cacheIndex=-1;for(var n=0;n<this._keys.length;n++)if(X(this._keys[n],t)){this._cacheIndex=n;break}}return this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function a(t,e){return[t,e]}}function ut(){return function(){function t(){this._map=new h}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.keys()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[s]=function(){return this.keys()},t}()}function lt(){var t=16,e=u.create(),r=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=s(t,!1);return void 0!==e&&u.has(e,this._key)},t.prototype.get=function(t){var e=s(t,!1);return void 0!==e?u.get(e,this._key):void 0},t.prototype.set=function(t,e){return s(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=s(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var t;do{t="@@WeakMap@@"+c()}while(u.has(e,t));return e[t]=!0,t}function s(t,e){if(!n.call(t,r)){if(!e)return;Object.defineProperty(t,r,{value:u.create()})}return t[r]}function a(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function o(t){if("function"==typeof Uint8Array){var e=new Uint8Array(t);return"undefined"!=typeof crypto?crypto.getRandomValues(e):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(e):a(e,t),e}return a(new Array(t),t)}function c(){var e=o(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<t;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function ht(t){return t.__=void 0,delete t.__,t}t("decorate",m),t("metadata",v),t("defineMetadata",w),t("hasMetadata",k),t("hasOwnMetadata",b),t("getMetadata",S),t("getOwnMetadata",_),t("getMetadataKeys",T),t("getOwnMetadataKeys",C),t("deleteMetadata",E)}(n,e),void 0===e.Reflect&&(e.Reflect=t)}()}(g||(g={}));class y extends Error{}function m(){throw new y}const v=(t,e)=>{t.push(e)};function w(t){this._0=t}function k(t){this._0=t}function b(t){this._0=t}w.prototype.$tag=0,w.prototype.type="enum",k.prototype.$tag=1,k.prototype.type="required",b.prototype.$tag=2,b.prototype.type="optional";const S={$tag:0};function _(t,e,n){const r=t.length;let i;if(void 0===n)i=r;else{i=n}return e>=0&&e<=i&&i<=r?t.substring(e,i):m()}function T(t,e){v(t,e)}function C(t,e){v(t,e)}function E(t,e){return 65536+(((0|Math.imul(t-55296|0,1024))+e|0)-56320|0)|0}function x(t){var e;e=t,console.log(e)}function A(t){const e=t._1,n=t._0;return e.length>0?(C(n,new w(function(t){return t.slice(0)}(e))),void function(t){!function(t){var e;e=0,t.length=e}(t)}(e)):void 0}function O(t){const e=[],n=[],r={val:-1},i={val:0},s={val:-1},a={val:-1},o={val:-1},c={val:-1},u={val:-1},l={val:-1},h={_0:e,_1:n};let p=S;const d=function(t){return e=>{const n=t.length;let r=0;for(;;){const i=r;if(i<n){const s=t.charCodeAt(i);if(55296<=s&&s<=56319&&(i+1|0)<n){const n=i+1|0,a=t.charCodeAt(n);if(56320<=a&&a<=57343){if(1===e(E(s,a))){r=i+2|0;continue}return 0}}if(1!==e(s))return 0;r=i+1|0;continue}return 1}}}(`${t}\0`);d(p=>{r.val=r.val+1|0;t:{e:{n:{r:{if(124===p){switch(i.val){case 1:i.val=3,a.val=r.val,T(n,_(t,s.val,a.val));break;case 2:i.val=3;break;default:x("Unexpected '|' character")}}else{if(32===p)break r;if(10===p)break r;if(60===p)i:{s:{switch(i.val){case 0:case 2:break s;default:x("Unexpected '<' character")}break i}i.val=4,A(h)}else if(62===p){switch(i.val){case 14:i.val=0,C(e,new k({name:_(t,o.val,c.val),vType:_(t,u.val,l.val)}));break;case 10:i.val=0,C(e,new k({name:_(t,o.val,c.val),vType:_(t,u.val,r.val)}));break;default:x("Unexpected '>' character")}}else if(91===p)i:{s:{switch(i.val){case 0:case 2:break s;default:x("Unexpected '[' character")}break i}i.val=5,A(h)}else if(93===p){switch(i.val){case 15:i.val=0,C(e,new b({name:_(t,o.val,c.val),vType:_(t,u.val,l.val)}));break;case 11:i.val=0,C(e,new b({name:_(t,o.val,c.val),vType:_(t,u.val,r.val)}));break;default:x("Unexpected ']' character")}}else if(58===p){switch(i.val){case 8:i.val=6,c.val=r.val;break;case 9:i.val=7,c.val=r.val;break;case 12:i.val=6;break;case 13:i.val=7;break;default:x("Unexpected ':' character")}}else{if(p>=97&&p<=122)break e;if(p>=65&&p<=90)break e;if(p>=48&&p<=57)break e;if(95===p)break e;if(0===p){switch(i.val){case 1:a.val=r.val,T(n,_(t,s.val,a.val)),A(h);break;case 2:A(h);break;case 0:break;default:x("Unexpected character")}}else x("Unexpected character")}}break n}switch(i.val){case 1:i.val=2,a.val=r.val,T(n,_(t,s.val,a.val));break;case 8:i.val=12,c.val=r.val;break;case 9:i.val=13,c.val=r.val;break;case 10:i.val=14,l.val=r.val;break;case 11:i.val=15,l.val=r.val;break;default:return 1}}break t}e:{n:{r:{i:{switch(i.val){case 0:case 3:break i;case 2:i.val=1,A(h),s.val=r.val;break;case 12:case 14:case 15:case 13:break n;case 4:i.val=8,o.val=r.val;break;case 5:i.val=9,o.val=r.val;break;case 6:i.val=10,u.val=r.val;break;case 7:i.val=11,u.val=r.val;break;default:return 1}break r}i.val=1,s.val=r.val}break e}x("Unexpected identifier")}}return 1});const f=p;switch(f.$tag){case 0:case 1:break;case 2:return f._0;default:m()}return e}const I={bool:t.Boolean,int:t.Integer,float:t.Float,string:t.String,entity:t.EntitySelector,actor:t.EntitySelector,player:t.PlayerSelector,xyz:t.Location,pos:t.Location,vec:t.Location,text:t.String,message:t.String,json:t.String,item:t.ItemType,block:t.BlockType,enum:t.Enum,entities:t.EntityType,actor_type:t.EntityType},R=new Map;class M{static registerFns=new Set;static registerAll(t){for(const e of M.registerFns)e(t)}static registerFromOptions({name:t,description:n,permissionLevel:r,cheatsRequired:i,parameters:s},a){return M.registerFns.add(o=>{s.filter(t=>"enum"===t.type).forEach(({_0:t})=>{const e="ss:enum_"+String(R.size);R.set(t,e),o.registerEnum(e,t)});const c=[],u=[],l=[];s.forEach(t=>{const{type:e,_0:n}=t;if("enum"===e){const e=t.optional,r=R.get(n);if(!r)return;return l.push(r),(e?u:c).push({name:r,type:I.enum})}const{name:r,vType:i}=n;return"required"===e?(l.push(r),c.push({name:r,type:I[i]})):"optional"===e?(l.push(r),u.push({name:r,type:I[i]})):void 0}),o.registerCommand({cheatsRequired:i,name:t,description:n,permissionLevel:r,mandatoryParameters:c,optionalParameters:u},(t,...n)=>{const r={};l.forEach((t,e)=>{r[t]=n[e]});let i={status:e.Success};return a(r,{rawArgs:n,origin:t,success(t){i.status=e.Success,i.message=t??""},failure(t){i.status=e.Failure,i.message=t??""}}),i})}),this}static register(t,e,r,i,s=n.GameDirectors,a=!0){const o={name:t,description:e,permissionLevel:s,cheatsRequired:a,parameters:O(r)};return this.registerFromOptions(o,i)}}var P;!function(t){t[t.Enum=0]="Enum",t[t.Required=1]="Required",t[t.Optional=2]="Optional",t[t.Origin=3]="Origin",t[t.Success=4]="Success",t[t.Fail=5]="Fail"}(P||(P={}));const N=new Map;function L(t){let e=N.get(t);return e||(e={name:"",description:"",permissionLevel:n.GameDirectors,cheatsRequired:!1,decoratedParams:[],wrapped:Function.prototype},N.set(t,e)),e}var F;function D({decoratedParams:t,name:e,description:n,permissionLevel:r,cheatsRequired:i,wrapped:s}){const a=[];let o=0;for(const e of t.toReversed()){const{name:t,type:n,argType:r,enums:i,optionalEnum:s}=e,c=t??`arg${o}`;if(!(n>2)){if(n===P.Enum){e.argIndex=o++;let t=new w(i??["default"]);s&&(t.optional=!0),a.push(t);continue}e.argIndex=o++,a.push(n===P.Required?new k({name:c,vType:r}):new b({name:c,vType:r}))}}M.registerFromOptions({name:e,description:n,permissionLevel:r,cheatsRequired:i,parameters:a},s)}function j(t,e=n.GameDirectors,r=!0,i,s="ss"){return(n,i,a)=>{const o=n[i];let c=L(o);const{decoratedParams:u}=c;return c.name=`${s}:${String(i)}`,c.description=t,c.permissionLevel=e,c.cheatsRequired=r,c.wrapped=function(t,{success:e,failure:n,origin:r,rawArgs:i}){const s=[];for(const{index:t,type:a,argIndex:o}of u)if(a<3)s[t]=i[o];else switch(a){case P.Origin:s[t]=r;continue;case P.Success:s[t]=e;continue;case P.Fail:s[t]=n;continue}return o(...s)},a}}!function(t){t.Enum=function(...t){return(e,n,r)=>{L(e[n]).decoratedParams.push({enums:t,index:r,type:P.Enum})}},t.OptionalEnum=function(...t){return(e,n,r)=>{L(e[n]).decoratedParams.push({optionalEnum:!0,enums:t,index:r,type:P.Enum})}},t.Required=function(t,e){return(n,r,i)=>{L(n[r]).decoratedParams.push({argType:t,name:e,index:i,type:P.Required})}},t.Optional=function(t,e){return(n,r,i)=>{L(n[r]).decoratedParams.push({argType:t,name:e,index:i,type:P.Optional})}},t.Origin=(t,e,n)=>{L(t[e]).decoratedParams.push({index:n,type:P.Origin})},t.Success=(t,e,n)=>{L(t[e]).decoratedParams.push({index:n,type:P.Success})},t.Fail=(t,e,n)=>{L(t[e]).decoratedParams.push({index:n,type:P.Optional})}}(F||(F={}));class ${static map=new Map;HEAD={prev:null,next:null};END=this.HEAD;count=0;append(t,e){const n=this.END,r={prev:n,listener:t,rawListener:e,next:null};return r.prev=n,r.listener=t,r.rawListener=e,r.next=null,n.next=r,this.END=r,$.map.set(e||t,r),this.count++,this}prepend(t,e){const n=this.HEAD,r=n.next,i={prev:n,listener:t,rawListener:e,next:r};return n.next=i,r&&(r.prev=i),$.map.set(e||t,i),this.count++,this}delete(t){let e=$.map,n=e.get(t);if(!n||!n.prev)return;let r=n.prev;return r.next=n.next,n.next&&(n.next.prev=r),e.delete(t),this.count--,requestIdleCallback(()=>{n.prev=null,n.next=null}),this}deleteAll(){let t=this.HEAD;for(;t=t.next;)t.prev=null,t.next=null,$.map.delete(t.rawListener||t.listener);return this.HEAD.next=null,this.count=0,this}[Symbol.iterator](){let t=this.HEAD;return{next:()=>t.next?(t=t.next,{value:t,done:!1}):{value:t,done:!0}}}}class B{static mod;static#t;static set contextActor(t){this.#t=t}static unsafeCtxActor(){return this.#t}static contextActorRef(){return new q(this.#t)}}class q{#e;constructor(t){this.#e=t}deref(){if(!this.isValid)return;const t=this.#e;return this.#e=void 0,t}get isValid(){const t=this.#e;return!!t&&Boolean(t?.entity?.isValid)}}class V{get actor(){return B.unsafeCtxActor()}allowTicking=!1;remove(){return this.removeComponent(this)}getComponent(t){return this.actor.getComponent(t)}addComponent(t,e){const{promise:n,resolve:r}=Promise.withResolvers();return this.actor.beforeNextUpdate(n=>{n.addComponent(t,e),r()}),n}removeComponent(t){const{promise:e,resolve:n}=Promise.withResolvers();return this.actor.beforeNextUpdate(e=>{e.removeComponent(t),n()}),e}}class U{events={};addListener(t,e){let n=this.events[t];n||(n=this.events[t]=new $),n.append(e)}trigger(t,...e){const n=this.events[t];if(n)for(const t of n)t.listener?.(...e)}removeListener(t,e){const n=this.events[t];n&&n.delete(e)}on=U.prototype.addListener;off=U.prototype.removeListener}class W extends V{events={};addListener(t,e){let n=this.events[t];n||(n=this.events[t]=new $),n.append(e)}trigger(t,...e){const n=this.events[t];if(n)for(const t of n)t.listener?.(...e)}removeListener(t,e){const n=this.events[t];n&&n.delete(e)}on=W.prototype.addListener;off=W.prototype.removeListener}class G{onNotify_;bind=(t,e)=>{this.onNotify_=e?t.bind(e):t};call=(...t)=>{this.onNotify_?.apply(void 0,t)};unbind=()=>{this.onNotify_=void 0}}const z=new class extends U{traverse(t,e,n=[]){Object.entries(t).forEach(([r,i])=>{const s=[...n,r];this.isObject(i)&&z.traverse(i,e,s),e(i,r,t,s)})}isObject(t){return null!==t&&"object"==typeof t}newObject(t,e=[]){const n=Reflect.construct(t,e);return this.trigger("construct",t,n,e),n}},K=new Set;var H;!function(t){t.queue=function(t){r.run(t)},t.timeout=function(t,e){r.runTimeout(t,e)},t.repeat=function(t,e){r.runInterval(t,e)},t.tickable=function(t,e){const n={allowTicking:!0,tickingGroup:t,tick:e};return i(t).add(e),n};const e=new Map;class n{group;dilation;lastTick=0;lastDate=0;tickables=new Set;constructor(t,e){this.group=t,this.dilation=e}add(t){this.tickables.add(t)}remove(t){this.tickables.delete(t)}tick(){const t=r.currentTick,e=Date.now(),n=(t-this.lastTick)*this.dilation,i=(e-this.lastDate)*this.dilation;for(const{tick:t,update:e,allowTicking:r}of this.tickables)r&&(t??e)?.(n,i);this.lastTick=t,this.lastDate=e}}function i(t){let r=e.get(t);return r||(r=new n(t,1),e.set(t,r)),r}t.Ticking=n,t.getTickingGroup=i,t.tick=function(t){e.get(t)?.tick()},t.clear=function(t){e.delete(t)},t.clearAll=function(){e.clear()},t.addTickingObject=function(t){i(t.tickingGroup).add(t)},t.removeTickingObject=function(t){i(t.tickingGroup).remove(t)},z.addListener("construct",(t,e)=>{const n=e;K.has(t)&&H.addTickingObject(n)})}(H||(H={}));class J{static with(t,e){let n=null;t?.enter?.();try{n=[e(),null]}catch(t){n=[null,t]}return t?.exit?.(),n}static async withAsync(t,e){let n=null;t?.enter?.();try{n=[await e(),null]}catch(t){n=[null,t]}return t?.exit?.(),n}static resouceMapping=new Map;static load(...t){return t.map(t=>{const e=Reflect.construct(t,[]);return this.resouceMapping.set(t,e),e?.enter?.(),e})}static getResouce(t){return this.resouceMapping.get(t)}static unload(...t){for(const e of t){const t=this.resouceMapping.get(e);t?.exit?.(),this.resouceMapping.delete(e)}}}const X=Symbol("isTag");class Y{tag;static _tagMap=new Map;static constructable={allowTagConstruct:!1,enter(){this.allowTagConstruct=!0},exit(){this.allowTagConstruct=!1}};static isValid(t){return!t.trim().split(".").some(t=>!t.match(/[\w\$]+/))}static of(t){return t[X]===Object.prototype?t:Y._tagMap.get(t)}_isValid;_childTag=new Set;[X]=Object.prototype;constructor(t){throw this.tag=t,new Error("Tag class is not allowed to construct")}get isValid(){return this._isValid}toString(){return this._isValid?this.tag:""}matchTag(t,e=!1){return!(!this.isValid||!t.isValid)&&(e?this===t:!!this._childTag.has(t)||!!this.tag.startsWith(t.tag)&&(this._childTag.add(t),!0))}match(t,e=!1){return this.matchTag(Y.of(t),e)}static hasTag(t,e,n=!1){const r=Y.of(e);return t.getTags().some(t=>Y.of(t).matchTag(r,n))}static hasTagAll(t,e,n=!1){return e.every(e=>Y.hasTag(t,e,n))}static hasTagAny(t,e,n=!1){return e.some(e=>Y.hasTag(t,e,n))}static addTag(t,e){const n=Y.of(e);n.isValid&&t.addTag(n.tag)}static addTags(t,e){e.forEach(e=>Y.addTag(t,e))}static removeTag(t,e){const n=Y.of(e);t.removeTag(n.tag),n._childTag.delete(n)}static removeTags(t,e){e.forEach(e=>Y.removeTag(t,e))}static discardTag(t){const e=Y.of(t);Y._tagMap.delete(e.tag),e._childTag.clear(),e._isValid=!1,r.run(()=>{for(const t of i.getAllPlayers())t.removeTag(e.tag)})}static fromObject(t){return J.with(this.constructable,()=>(z.traverse(t,(t,e,n,r)=>{if(null===t){const t=this.of(r.join("."));if(!t.isValid)return null;n[e]=t}}),Object.freeze(t)))[0]}}class Q{hasTag(t,e=!1){return Y.hasTag(this,t,e)}hasTagAll(t,e=!1){return Y.hasTagAll(this,t,e)}hasTagAny(t,e=!1){return Y.hasTagAny(this,t,e)}addTags(t){Y.addTags(this,t)}removeTags(t){Y.removeTags(this,t)}discardTag(t){Y.discardTag(t)}}const Z=Symbol("isActor");class tt extends Q{id;constructor(t){super(),this.id=t,H.addTickingObject(this)}[Z]=!0;static isActor(t){return t&&!0===t[Z]}components=new Map;beforeNextTickCbs=new Set;tickingGroup="actor";tags=[];allowTicking=!0;getTags(){return this.tags}addTag(t){this.tags.push(t)}removeTag(t){this.tags.splice(this.tags.indexOf(t),1)}addComponent(t,e){if(Array.isArray(t)){for(const e of t)this.addComponent(e);return this}const[n,r]="string"==typeof t?[t,e]:[t.constructor.name,t];if(!r)throw new Error("Component must be provided when adding a component.");return this.components.set(n,r),r.attach?.(),this._componentsReady.add(n),this._componentsStarted&&(B.contextActor=this,r.start?.()),this}removeComponent(t){const e="string"==typeof t?t:t.constructor.name,n=this.components.get(e);return n&&n.detach?.(),this.components.delete(e),this}getComponent(t){return this.components.get("string"==typeof t?t:t.name)}getComponents(){return Array.from(this.components.values())}clear(){for(const t of this.components.values())t.detach?.();this.components.clear(),this._componentsStarted=!1,this._componentsReady.clear()}beforeNextUpdate(t){this.beforeNextTickCbs.add(t)}tick=(t,e)=>{if(this._componentsStarted){this.beforeNextTickCbs.forEach(t=>t(this)),this.beforeNextTickCbs.clear(),B.contextActor=this;for(const n of this.components.values())n.allowTicking&&n.update?.(t,e)}};start(){if(!this._componentsStarted){B.contextActor=this;for(const t of this.components.values())t.start?.()}}despawn(){}_componentsReady=new Set;_componentsStarted=!1;tryStart(){this._componentsStarted||this._componentsReady.size===this.components.size&&(this.start(),this._componentsStarted=!0)}}const et={SLOW:6,FAST:2.78,SLOW_COLOR:"§c",MEDIUM_COLOR:"§e",FAST_COLOR:"§a",NUM_FIXED:2,TOKENS:{FN:"§6",GET:"§3",ID:"§b",CLASS:"§a",STR:"§v",BOOL:"§1",NUM:"§5",ENT:"§5",R:"§r"}},{TOKENS:nt,FAST:rt,SLOW:it,FAST_COLOR:st,SLOW_COLOR:at,MEDIUM_COLOR:ot,NUM_FIXED:ct}=et;var ut,lt,ht,pt;!function(t){function e(t,e){!function(t,e){function n(t){r.run(()=>i.sendMessage(t))}switch(t){case"debug":case"info":n(`§b[INFO]§r\n${e}`);break;case"warn":n(`§e[WARN]§r\n${e}`);break;case"error":n(`§c[ERR]§r\n${e}`)}}(t,e)}const n=["string","number","boolean","bigint","undefined","symbol"],s=(t,e,n)=>`  ${nt.ID}${e}§r: ${t}${t===nt.STR?`'${n}'`:n}§r`,a=(t,e=!1)=>`  ${e?nt.GET:nt.FN}${e?"get ":""}${t??"[anonymous]"}§r()`,o={string:nt.STR,number:nt.NUM,boolean:nt.BOOL,bigint:nt.NUM,undefined:"§7",symbol:nt.STR},c=[Object.prototype,Array.prototype,Function.prototype,String.prototype,Number.prototype,Boolean.prototype,BigInt.prototype,Symbol.prototype,Error.prototype],u=new Map;function l(...t){return t.map(t=>{const e=typeof t;if(n.includes(e))return String(t);if("function"===e)return t.name||"anonymous()";if("nameTag"in t)return t.nameTag;if("typeId"in t)return t.typeId;if(u.size)for(const[e,n]of u)if(e(t))return n(t);let r=t;const i=[];do{Object.entries(Object.getOwnPropertyDescriptors(r)).map(([t,e])=>{if("constructor"===t)return;if(e.get)return i.push(a(t,!0));const r=e.value,c=typeof r;return n.includes(c)?i.push(s(o[c],t,r)):"function"===c?i.push(a(r.name)):"nameTag"in r?i.push(s(nt.ENT,t,`${r.typeId.replace("minecraft:","")}{name=${r.nameTag}}`)):"typeId"in r?i.push(s(nt.ENT,t,r.typeId.replace("minecraft:",""))):i.push(s(nt.CLASS,t,r?.constructor?.name||"{}"))})}while(!c.includes(r=Reflect.getPrototypeOf(r)));return i.unshift(`${t?.constructor?.name||""} {}:`),i.push(""),i.join("\n")}).join(" ")}function h(t,...n){e(t,l(...n))}function p(...t){h("info",...t)}t.registerCustomPrinter=function(t,e){u.set(t,e)},t.registerCustomTypePrinter=function(t,e){u.set(e=>e instanceof t,e)},t.format=l,t.print=h,t.debug=function(...t){h("debug",...t)},t.info=p,t.warn=function(...t){h("warn",...t)},t.error=function(...t){h("error",...t)},t.prof=function(t,e,...n){const r=Date.now(),i=e(...n),s=Date.now()-r;return p(`Task ${nt.FN}${t}§r executed in ${s<rt?st:s<it?ot:at}${s.toFixed(ct)}ms`),i}}(ut||(ut={}));class dt extends tt{entityRef;constructor(t){super(t.id),this.entityRef=t}controller=null;onPossess(t){this.controller=t}onUnPossess(){this.controller=null}getController(){return this.controller}get entity(){return this.entityRef&&this.entityRef.isValid?this.entityRef:(this.entityRef=null,null)}getNativeComponent(t){const e=this.entity?.getComponent(t);if(e&&e.isValid)return e}setEquipment(t,e){const n=this.getNativeComponent(s.componentId);return Boolean(n?.setEquipment(t,e))}getEquipment(t){const e=this.getNativeComponent(s.componentId);if(e?.isValid)return e.getEquipment(t)}_inv;get inventory(){return this._inv?.isValid?this._inv:this._inv=this.getNativeComponent(a.componentId)}}function ft(t,e,n){return Math.min(Math.max(t,e),n)}class gt extends tt{pawn=null;possess(t){if(this.pawn)throw new Error("Controller already possess a pawn");this.pawn=t,t.onPossess(this)}unPossess(){this.pawn&&(this.pawn.onUnPossess(),this.pawn=null)}getPawn(){return this.pawn}}function yt(t){return{value:t,lastUpdate:r.currentTick}}!function(t){t[t.None=0]="None",t[t.Started=1]="Started",t[t.Triggered=2]="Triggered",t[t.Compeleted=3]="Compeleted"}(lt||(lt={})),function(t){t[t.None=0]="None",t[t.Cancel=1]="Cancel",t[t.Finish=2]="Finish",t[t.Compelete=3]="Compelete"}(ht||(ht={})),function(t){t[t.Jump=0]="Jump",t[t.Sneak=1]="Sneak",t[t.Sprint=2]="Sprint",t[t.Attack=3]="Attack",t[t.Interact=4]="Interact",t[t.Movement=5]="Movement"}(pt||(pt={}));class mt extends W{static canUsePlayerSwing=Boolean(i.afterEvents.playerSwingStart);static inputStacks=new Map;static swingPlayers=new Set;allowTicking=!0;static{function t(t){mt.inputStacks.get(t)?.push({button:"Interact",value:!0,ticks:r.currentTick}),r.runTimeout(()=>{mt.inputStacks.get(t)?.push({button:"Interact",value:!1,ticks:r.currentTick})},2)}i.afterEvents.playerButtonInput.subscribe(t=>t.button===o.Jump?mt.inputStacks.get(t.player.id)?.push({button:"Jump",value:t.newButtonState===c.Pressed,ticks:r.currentTick}):t.button===o.Sneak?mt.inputStacks.get(t.player.id)?.push({button:"Sneak",value:t.newButtonState===c.Pressed,ticks:r.currentTick}):void 0),r.beforeEvents.startup.subscribe(t=>{t.itemComponentRegistry.registerCustomComponent("ss:chargeable",{})}),i.afterEvents.itemUse.subscribe(t=>{t.itemStack.hasComponent("ss:chargeable")&&mt.inputStacks.get(t.source.id)?.push({button:"Interact",value:!0,ticks:r.currentTick})}),i.afterEvents.playerPlaceBlock.subscribe(e=>t(e.player.id)),i.afterEvents.playerInteractWithBlock.subscribe(e=>t(e.player.id)),i.afterEvents.playerInteractWithEntity.subscribe(e=>t(e.player.id)),i.afterEvents.itemReleaseUse.subscribe(t=>mt.inputStacks.get(t.source.id)?.push({button:"Interact",value:!1,ticks:r.currentTick})),r.afterEvents.scriptEventReceive.subscribe(({sourceEntity:t,id:e})=>{if(t)switch(e){case"ss:drawStart":if(this.canUsePlayerSwing)return;this.swingPlayers.add(t.id);case"ss:drawEnd":return mt.inputStacks.get(t.id)?.push({button:"Attack",value:!1,ticks:r.currentTick});case"ss:sprintEnd":return mt.inputStacks.get(t.id)?.push({button:"Sprint",value:!1,ticks:r.currentTick});case"ss:sprintStart":return mt.inputStacks.get(t.id)?.push({button:"Sprint",value:!0,ticks:r.currentTick})}}),this.canUsePlayerSwing&&(i.afterEvents.playerSwingStart.subscribe(t=>this.swingPlayers.add(t.player.id),{heldItemOption:u.AnyItem}),i.afterEvents.playerSwingStart.subscribe(t=>this.swingPlayers.add(t.player.id),{heldItemOption:u.NoItem})),i.beforeEvents.playerBreakBlock.subscribe(t=>mt.inputStacks.get(t.player.id)?.push({button:"Attack",value:!0,ticks:r.currentTick}))}get bindActor(){return this.actor.getPawn()}start(){this.bindActor?.entity&&mt.inputStacks.set(this.bindActor.entity.id,[])}inputMapping={Jump:yt(!1),Sneak:yt(!1),Sprint:yt(!1),Attack:yt(!1),Interact:yt(!1),Movement:yt({x:0,y:0})};getInput(t){return this.inputMapping[t].value}getChargeEventStateFromMainhand(t){const e=this.bindActor?.getEquipment(l.Mainhand);if(!e)return ht.None;const{triggerThreshold:n,holdThreshold:r}=e.getComponent("ss:chargeable")?.customComponentParameters.params||{};return this.getChargeEventState(t,n??0,r??Number.MAX_SAFE_INTEGER)}getChargingStateFromMainhand(t){const e=this.bindActor?.getEquipment(l.Mainhand);if(!e)return lt.None;const{triggerThreshold:n,holdThreshold:r}=e.getComponent("ss:chargeable")?.customComponentParameters.params||{};return this.getChargingState(t,n??0,r??Number.MAX_SAFE_INTEGER)}getChargingState(t,e,n){const r=e+n;return t<0?lt.None:t<e?lt.Started:t<r?lt.Triggered:lt.Compeleted}getChargeEventState(t,e,n){const r=e+n;return t<0?ht.None:t<e?ht.Cancel:t<r?ht.Finish:ht.Compelete}stop(){this.bindActor?.entity&&mt.inputStacks.delete(this.bindActor.entity.id)}destroy(){this.bindActor?.entity&&mt.inputStacks.clear()}update(){if(!this.bindActor?.entity)return;const t=this.bindActor.entity.id,e=mt.inputStacks.get(t);if(!e)return;let n=mt.swingPlayers.has(t);for(const{button:r,value:i,ticks:s}of e){if(n){mt.swingPlayers.delete(t);if(this.inputMapping.Interact.value){n=!1;continue}}const e=this.inputMapping[r];if(e.value!==i){const t=s-e.lastUpdate;e.value=i,e.lastUpdate=s,this.trigger(r,i,t)}}n&&this.trigger("Attack",!0,0),e.length=0}getInputVector(){return this.useSimulatedVector?this.inputMapping.Movement.value:this.bindActor?.entity?.inputInfo.getMovementVector()}useSimulatedVector=!1;static performPressing(t,e,n){mt.inputStacks.get(t)?.push({button:e,value:n,ticks:r.currentTick})}static performVector(t,e,n){mt.inputStacks.get(t)?.push({button:"Movement",value:{x:e,y:n},ticks:r.currentTick})}isMovingForward(){return this.getInputVector().y>.5}}class vt extends gt{inputComponent=new mt;setupInput(){this.addComponent(this.inputComponent)}}const wt=["minecraft:player"],kt=[],bt=[],St={"minecraft:player":class extends dt{#n=20;get health(){return this.#n}set health(t){const e=this.entity;if(e){const n=e.getComponent(h.componentId);if(n.isValid){if(n.currentValue===t)return;n.setCurrentValue(ft(t,0,20))}}}}},_t=vt,Tt={};let Ct=null;class Et{static instance;static getInst(){return this.instance||(this.instance=new Et),this.instance}specifiedActorComponents={};actorComponentsLoader=t=>[...kt.map(t=>new t),...((t?this.specifiedActorComponents[t]:[])??[]).map(t=>new t)];playerComponentsLoader=()=>[...this.actorComponentsLoader("minecraft:player"),...bt.map(t=>new t)];defaultSpawnClass=tt;spawnClass=St;defaultPlayerControllerClass=vt;aiClass=Tt;registerPlayerComponent(t){bt.push(t)}registerSpecifiedActorComponent(t,...e){let n=this.specifiedActorComponents[t]??[];this.specifiedActorComponents[t]=n.concat(e)}registerActorComponent(t){kt.push(t)}registerSpawnClass(t,e){this.spawnClass[t]=e}registerPlayerControllerClass(t){this.defaultPlayerControllerClass=t}registerAiControllerClass(t,e){this.aiClass[t]=e}findSpawnClass(t,e=!1){return e?this.spawnClass[t]:this.spawnClass[t]??this.defaultSpawnClass??tt}findPlayerControllerClass(){return Ct??_t??this.defaultPlayerControllerClass}findAiControllerClass(t){return this.aiClass[t]}canAutoSpawn(t){return wt.includes(t)}registerAutoSpawn(t){wt.push(t)}}const{TOKENS:xt}=et;class At extends U{actors=new Map;spawnConfig=Et.getInst();static getInst(){return J.getResouce(At)}static modApp=null;initialized=!1;spawnActor(t,e,...n){const r=Reflect.construct(e,[t]);n.forEach(t=>r.addComponent(t)),this.actors.set(t,r);try{this.trigger("actorSpawned",r,e,n)}catch(t){ut.error(t)}return r}despawnActor(t){if(!this.initialized)throw new Error("Application must be initialized before despawning actors.");const e=this.actors.get(t);try{this.trigger("actorDespawn",e,t)}catch(t){ut.error(t)}e&&e.despawn(),this.actors.delete(t)}despawnEntityActor(t){if(!this.initialized)throw new Error("Application must be initialized before despawning actors.");const e=t.id,n=this.actors.get(e);try{this.trigger("actorDespawn",n,e)}catch(t){ut.error(t)}n&&(n.despawn(),n.entity&&n.entity.remove()),this.actors.delete(e)}getActor(t){return this.actors.get(t)}spawnEntityActor(t,e,...n){if("string"==typeof t){const r=t,s=e,a=n.shift(),o=i.getDimension(s.dimension).spawnEntity(r,s);return this.spawnEntityActor(o,a,...n)}if(Array.isArray(e))return this.spawnEntityActor(t,this.spawnConfig.findSpawnClass(t.typeId),...e);const r=e,s=this.actors.get(t.id);if(s){try{this.trigger("actorSpawned",s,r,n)}catch(t){ut.error(t)}return s}const a=Reflect.construct(r,[t]);n.forEach(t=>a.addComponent(t)),this.actors.set(t.id,a);try{this.trigger("actorSpawned",a,r,n)}catch(t){ut.error(t)}return a}serverStarted=Promise.withResolvers();playerControllers=[];getControllerByActorId(t){const e=this.getActor(t);if(e)return e.getController()}enter=()=>{if(this.initialized)return;const t=this.spawnConfig;this.setConfig("SpawnConfig",t),r.beforeEvents.startup.subscribe(e=>{this.serverStarted.resolve(e),this.initialized=!0,At.modApp?.start?.(this,e),function(){for(const t of N.values())D(t);N.clear()}(),M.registerAll(e.customCommandRegistry);const n=e=>{if(t.canAutoSpawn("minecraft:player")){const n=`pc_${this.playerControllers.length}`,r=this.spawnActor(n,t.findPlayerControllerClass());this.playerControllers.push(r);const i=this.spawnEntityActor(e,t.findSpawnClass(e.typeId),...t.playerComponentsLoader());r.possess(i),r.setupInput(),r.tryStart(),i.tryStart()}};i.afterEvents.playerSpawn.subscribe(t=>n(t.player));const s=e=>{const n=t.findSpawnClass(e.typeId,!0),r=e.id;if("minecraft:player"!==r&&t.canAutoSpawn(r)&&n){const i=this.spawnEntityActor(e,n,...t.actorComponentsLoader(r)),s=t.findAiControllerClass(r);if(s){const t=`ac_${s.name}_${r}`,e=this.spawnActor(t,s);e.possess(i),e.tryStart()}i.tryStart()}};i.afterEvents.entitySpawn.subscribe(t=>s(t.entity)),i.beforeEvents.entityRemove.subscribe(t=>this.despawnActor(t.removedEntity.id)),r.run(()=>{for(const t of this.actors.values())t.tryStart();At.modApp?.initialized?.(this)})}),r.beforeEvents.shutdown.subscribe(()=>{At.modApp?.exit?.()}),H.repeat(()=>H.tick("actor"))};exit(){H.clearAll()}getPlayerController(t=0){return this.playerControllers.at(t)}plugins=new Map;loadPlugin(...t){return t.forEach(t=>{const e=Reflect.construct(t,[]);e.startModule(this),this.plugins.set(e.name,e)}),this}unloadPlugin(...t){return t.forEach(t=>{const e=this.plugins.get(t);e&&(e?.stopModule?.(this),this.plugins.delete(t))}),this}getPlugin(t){return this.plugins.get(t)}_config={};getConfig(t,e){return this._config[t]??e}setConfig(t,e){this._config[t]=e}}class Ot{show_actor(t){t.map(t=>{const e=At.getInst().getActor(t.id);ut.info(e)})}show_actors(){ut.info([...At.getInst().actors.keys()])}show_controller(t){t.forEach(t=>{const e=At.getInst().getActor(t.id);if(!e)return ut.error(`Actor ${t.id} not found`);ut.info(e.getController())})}show_components(t){t.forEach(t=>{const e=At.getInst().getActor(t.id);if(!e)return ut.error(`Actor ${t.id} not found`);ut.info(e.getComponents())})}show_controller_components(t){t.forEach(t=>{const e=At.getInst().getActor(t.id);if(!e)return ut.error(`Actor ${t.id} not found`);const n=e.getController();if(!tt.isActor(n))return ut.error(`Actor ${t.id} is not a pawn`);ut.info(n.getComponents())})}show_plugins(){const t=Array.from(At.getInst().plugins.values()).map(({name:t,description:e})=>`\n${xt.ID}${t}§r: ${xt.STR}${e}`);ut.info(`已加载${t.length}个插件:`,...t)}}p([j("查看 Actor"),d(0,F.Required("actor","actors")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Ot.prototype,"show_actor",null),p([j("查看所有 Actors"),f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],Ot.prototype,"show_actors",null),p([j("查看 Player Controller / AI Controller"),d(0,F.Required("actor","actors")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Ot.prototype,"show_controller",null),p([j("查看 Actor Components"),d(0,F.Required("actor","pawn")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Ot.prototype,"show_components",null),p([j("查看 Controller Components"),d(0,F.Required("actor","pawn")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Ot.prototype,"show_controller_components",null),p([j("查看 Application Plugins"),f("design:type",Function),f("design:paramtypes",[]),f("design:returntype",void 0)],Ot.prototype,"show_plugins",null);class It{constructor(){At.modApp=this,B.mod=this}}class Rt extends V{start(){const t=this.actor?.getController()?.getComponent(mt);if(!t)return void this.remove();const e=B.contextActorRef().deref();t.addListener("Interact",t=>{if(!t)return;const n=e.getEquipment(l.Mainhand)?.typeId;return"ss:control.det_up"===n?e.determination+=1:"ss:control.det_down"===n?e.determination-=1:"ss:control.detlvl_up"===n?e.determLevel+=1:"ss:control.detlvl_down"===n?e.determLevel-=1:"ss:control.mental_up"===n?e.mental+=1:"ss:control.mental_down"===n?e.mental-=1:void 0})}}var Mt,Pt;!function(t){t[t.Sane=0]="Sane",t[t.Neutral=1]="Neutral",t[t.Insane=2]="Insane"}(Mt||(Mt={}));class Nt extends dt{#n=20;get health(){return this.#n}set health(t){const e=this.entity;if(e){const n=e.getComponent(h.componentId);if(n.isValid){if(n.currentValue===t)return;n.setCurrentValue(ft(t,0,20))}}}#r=0;#i=2;get determLevel(){return this.#i}set determLevel(t){this.#i=ft(t,2,20)}upgradeDetermination(){this.determLevel+=1}downgradeDetermination(){this.determLevel-=1}get determination(){return this.#r}set determination(t){this.#r=ft(t,-this.#i,this.#i)}resetDetermination(){this.#r=0}#s=1;get mental(){return this.#s}set mental(t){this.#s=ft(t,1,10)}upgradeMental(){this.mental+=1}downgradeMental(){this.mental-=1}isSane(){return this.#r>0}isNeutral(){return!this.isSane()&&Math.abs(this.#r)/this.#i<=this.mental/10}isInsane(){return!this.isSane()&&!this.isNeutral()}get determinationState(){return this.isSane()?Mt.Sane:this.isNeutral()?Mt.Neutral:Mt.Insane}get damageMultiplier(){return this.isSane()?1.1:this.isNeutral()?1:1.25}get hurtMultiplier(){return this.isInsane()?1.1:1}}!function(t){t.Black="§0",t.DarkBlue="§1",t.DarkGreen="§2",t.DarkAqua="§3",t.DarkRed="§4",t.DarkPurple="§5",t.Gold="§6",t.Gray="§7",t.DarkGray="§8",t.Blue="§9",t.Green="§a",t.Aqua="§b",t.Red="§c",t.LightPurple="§d",t.Yellow="§e",t.White="§f",t.MinecoinGold="§g",t.Obfuscated="§k",t.Bold="§l",t.Italic="§o",t.Reset="§r"}(Pt||(Pt={}));class Lt{id;constructor(t,e="",n=[]){this.id=t,this.text=e,this.styles=n}#a="";get text(){return this.#a}set text(t){this.#a=t,this.changed=!0}#o=[];get styles(){return this.#o}set styles(t){this.#o=t,this.changed=!0}content=[];changed=!0;cache="";#c(){return this.changed?(this.changed=!1,this.cache=this.styles.join("")+this.text+Pt.Reset,this.cache):this.cache}toString(){return this.#c()+this.content.map(t=>t.toString()).join("")}addContent(t){return this.content.push(t),this}removeContent(t){"number"==typeof t?this.content.splice(t,1):"string"==typeof t?this.removeContentById(t):this.removeContentById(t.id)}removeContentById(t){const e=this.content.findIndex(e=>"string"!=typeof e&&e.id===t);-1!==e&&this.removeContent(e)}createInline(t,e,n=[]){const r=new Lt(t,e.trim(),n);return this.addContent(r),r}createBlock(t,e,n=[]){const r=new Lt(t,"\n"+e.trim(),n);return this.addContent(r),r}}class Ft extends V{messege=new Lt("ActionBar.Root");allowTicking=!0;update(){const t=this.actor.entity;t&&t.onScreenDisplay.isValid&&t.onScreenDisplay.setActionBar(this.messege.toString())}}class Dt extends V{allowTicking=!0;static maxWidth=40;static StyleRed=[Pt.Red];static StyleWhite=[Pt.White];static StyleSaneTrack=[Pt.DarkAqua];static StyleNetrualTrack=[Pt.Gold];static StyleInsaneTrack=[Pt.DarkRed];message=new Lt("ActionBar.Det");value=this.message.createInline("ActionBar.Det.Value","");bar=this.message.createInline("ActionBar.Det.Bar","");text=this.message.createInline("ActionBar.Det.Text","");insaneTrack=this.bar.createInline("ActionBar.Det.InsaneTrack","",Dt.StyleInsaneTrack);neutralTrack=this.bar.createInline("ActionBar.Det.NeutralTrack","",Dt.StyleNetrualTrack);saneTrack=this.bar.createInline("ActionBar.Det.SaneTrack","",Dt.StyleSaneTrack);fillText="▎";emptyText="▎";start(){this.getComponent(Ft).messege.addContent(this.message),this.text.styles=[Pt.White],this.actor instanceof Nt||this.removeComponent(this)}update(){const t=this.actor,e=.5+t.determination/(2*t.determLevel),n=ft(Math.round(e*Dt.maxWidth),0,Dt.maxWidth),r=.5-t.mental/20,i=Dt.maxWidth/2;this.value.text=this.fillText.repeat(n),this.text.text=String(t.determination).padStart(4," ")+"/"+String(t.determLevel),this.value.styles=e<r?Dt.StyleRed:Dt.StyleWhite,this.saneTrack.text="",this.neutralTrack.text="";let s=Dt.maxWidth-n;const a=Math.round(r*Dt.maxWidth);if(e>=r)this.insaneTrack.text="";else{const t=a-n;this.insaneTrack.text=this.emptyText.repeat(t),s-=t}if(e>=.5)this.neutralTrack.text="";else if(e<r){const t=i-a;this.neutralTrack.text=this.emptyText.repeat(t),s-=t}else{const t=i-n;this.neutralTrack.text=this.emptyText.repeat(t),s-=t}this.saneTrack.text=this.emptyText.repeat(s)}}class jt extends gt{inputComponent=new mt;OnAttack=new G;OnInteract=new G;OnSneak=new G;OnSprint=new G;OnJump=new G;setupInput(){this.addComponent(this.inputComponent),this.getPawn()?.addComponent(new Rt),this.inputComponent.addListener("Attack",this.OnAttack.call),this.inputComponent.addListener("Interact",this.OnInteract.call),this.inputComponent.addListener("Sprint",this.OnSprint.call),this.inputComponent.addListener("Sneak",this.OnSneak.call),this.inputComponent.addListener("Jump",this.OnJump.call)}}class $t{name="RoninBase";description="浪人系统的基础插件 (默认情况只提供最小功能)";startModule(){var t;t=Nt,St["minecraft:player"]=t,function(t){Ct=t}(jt),function(...t){bt.push(...t)}(Ft,Dt,Rt)}}const Bt="Ronin.StateTreeConfig";class qt extends V{allowTicking=!0;stateTree;update(){this.stateTree?.update()}start(){const t=At.getInst().getConfig(Bt,{}),e=this.actor.entity;if(!e)return;const n=t[e.typeId];n&&(this.stateTree=new n(this.actor))}}class Vt{name;payload;constructor(t,e){this.name=t,this.payload=e}keepCurrentState=!1;tryTransitionEveryTick=!1;transitionOnFinished=!0;taskNames=[];parent;children=[];appendChild(t){return t.parent=this,this.children.push(t),this}_removeChildByState(t){const e=this.children.indexOf(t);return e>-1&&(this.children.splice(e,1),t.parent=void 0),this}_removeChildByName(t){const e=this.children.find(e=>e.name===t);if(e)return this._removeChildByState(e)}removeChild(t){return"string"==typeof t?this._removeChildByName(t):this._removeChildByState(t)}OnStateTreeEvent=new G;canEnter(t){return!0}onEnter(t,e){}onExit(t,e){}canTransitionTo(t){return"root"}}class Ut extends Vt{constructor(){super("root")}canEnter(t){return!0}}class Wt extends U{Root=new Ut;tasks={};_curState=this.Root;_taskFinished=!0;_shouldTransition=!0;getCurrentState(){return this._curState}getExecutingTasks(){return this._curState.taskNames}addTask(t,e){this.tasks[t]=e}removeTask(t){delete this.tasks[t]}getTaskNames(){return Object.keys(this.tasks)}async executeTasks(){const t=this._curState;if(!t||0===t.taskNames.length)return!0;this._taskFinished=!1;try{for(const e of t.taskNames)await(this.tasks[e]?.(t,this));return this._taskFinished=!0,!0}catch(t){return!1}}finishTasks(){this._taskFinished=!0,this._shouldTransition=!0}_cachedStates={};searchState(t){if("object"==typeof t&&t)return this._cachedStates[t.name]=t,t;if(this._cachedStates[t])return this._cachedStates[t];let e=[this.Root],n=[];for(;n=e.map(t=>t.children).flat();){for(const n of e){const e=n.name;if(this._cachedStates[e]=n,e===t)return n}e=n}}tryTransitionTo(t){const e=this.searchState(t);return!(!e||!e.canEnter(this))&&this.transitionTo(e)}transitionTo(t){const e=this._curState;try{return e.onExit?.(this,t),this._curState=t,this._curState.onEnter?.(this,e),!0}catch{return!1}}resetStateTree(){this._curState=this.Root,this._taskFinished=!0,this._shouldTransition=!0}tryTransition(){this._shouldTransition=!1;const t=this._curState.canTransitionTo?.(this);if(t&&this.tryTransitionTo(t))return;this._curState.keepCurrentState;const e=this.searchStateCanEnter(this._curState);e&&this.transitionTo(e)||this.resetStateTree()}_isLeafNode(t){return 0===t.children.length}searchStateCanEnter(t,e=[],n=t){if(!n)return null;if(this._isLeafNode(n))return n.canEnter(this)?n:null;for(const r of n.children){if(e.includes(r))continue;const n=this.searchStateCanEnter(t,e,r);if(n)return n}return e.push(n),this.searchStateCanEnter(t,e,n.parent)}update(){this._taskFinished&&(this.executeTasks(),this._taskFinished=!1),(this._shouldTransition||this._curState.tryTransitionEveryTick||this._curState.transitionOnFinished&&this._taskFinished&&!this._curState.keepCurrentState)&&this.tryTransition()}}const{TOKENS:Gt}=et;function zt(t,e){return t.getActor(e.id)?.getComponent(qt)?.stateTree}class Kt{name="StateTree";description="状态树插件 (提供状态树相关功能，用于动作类型的游戏设计)";show_state_tree(t){const e=At.getInst();t.forEach(t=>{ut.info(zt(e,t))})}state_tree_current_state(t){const e=At.getInst();t.forEach(t=>{const n=zt(e,t);ut.info(n?.getCurrentState())})}state_tree_current_tasks(t){const e=At.getInst();t.forEach(t=>{const n=zt(e,t);ut.info(n?.getExecutingTasks())})}state_tree_tasks(t){const e=At.getInst();t.forEach(t=>{const n=zt(e,t);ut.info(n?.getTaskNames())})}startModule(t){const e=t.getConfig(Bt,{}),n=t.getConfig("SpawnConfig");for(const t of Object.keys(e))n.registerSpecifiedActorComponent(t,qt);ut.registerCustomTypePrinter(Wt,t=>`状态树\n当前状态: ${ut.format(t.getCurrentState())}\n当前任务: ${ut.format(t.getExecutingTasks())}`),ut.registerCustomTypePrinter(Vt,t=>{const{name:e,payload:n,keepCurrentState:r,tryTransitionEveryTick:i,transitionOnFinished:s,taskNames:a}=t;return`${Gt.ID+e+Gt.R}\n`+ut.format({name:e,payload:n,keepCurrentState:r,tryTransitionEveryTick:i,transitionOnFinished:s,taskNames:a})})}}p([j("查看 Pawn 状态树"),d(0,F.Required("actor")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Kt.prototype,"show_state_tree",null),p([j("查看状态树当前状态"),d(0,F.Required("actor")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Kt.prototype,"state_tree_current_state",null),p([j("查看状态树当前运行的任务"),d(0,F.Required("actor")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Kt.prototype,"state_tree_current_tasks",null),p([j("查看注册到状态树的所有任务"),d(0,F.Required("actor")),f("design:type",Function),f("design:paramtypes",[Array]),f("design:returntype",void 0)],Kt.prototype,"state_tree_tasks",null);let Ht=class extends It{start(t){t.setConfig(Bt,{"minecraft:player":Wt}),t.loadPlugin($t,Kt)}};Ht=p([function(t){J.load(t,At)}],Ht);export{Ht as MyMod};
